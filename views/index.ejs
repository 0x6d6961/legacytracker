<!DOCTYPE html>
<html lang="en">
<head>
<meta name="author" content="sui">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="language" content="English">
<meta name="description" content="Small Legacy Tracker is Legacy Minecraft Server tracking panel">
<meta name="title" content="SLT">
<meta name="theme-color" content="#131313">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<%- include('../partials/head') %>
<title>SLT</title>
</head>
<%- include('../partials/header') %>

<h2>SLT</h2>
<p>Small Legacy Server tracker</p>


<div class="card bg-dark">
    <div class="card-header">Graph of the Servers</div>
    <div class="card-body h-100 d-flex align-items-center justify-content-center serv"> <div class="serv" style="height: 300px; width:100%;"><canvas id="myChart"></canvas></div></div>
</div>

<br>
<div class="table-responsive-lg">
<table class="table table-bordered">
<thead>
<tr>
<th class="text-center text-bold"><i class="fa fa-file-image-o" aria-hidden="true"></i></th>
<th>Server</th>
<th>IP</th>
<th>Description</th>
<th>Online</th>
<th>Peak</th>
</tr>
</thead>
<tbody>

<% data.forEach(element => { %>
<tr>
<td class="text-center"><img src="data:image/png;base64,<%= element.icon %>" alt="<%= element.name %>" width="50px"></td>
<td><a href="server/<%= element.id %>"><%= element.name %></a></td>
<td><%= element.ip %></td>
<td><%= element.desc %></td>
<td><%= element.online %></td>
<td><%= element.peak %></td>
</tr>
<% }) %>
</tbody>
</table>
</div>

<script src="assets/index.js"></script>
<script>

$.ajax({
  url:"api/serversHistory",
    method: "GET",
    success: function(data){

    if(data.success != true) {
    $(".serv").text("Error fetching server graph");
    }
  else {

    console.log(data);

    let builder = [];
    let t = [];

    data.servers.forEach((element, key) => {
       builder.push({
        label: element.name,
        data: element.cnt,
        borderWidth: 1,
        fill: false,
        borderColor: colorArray[key+1]
      }) 
    });


      console.log(builder);



    new Chart("myChart", {
        type: "line",
        data: {
        labels: data.timestamps,
        datasets: builder,
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        legend: {display: true},
        scales: {
        xAxes: [{
        gridLines: {
        display:false
        },
        ticks: {
        display: false,
        beginAtZero: true
        }
        }],

        yAxes: [{
        gridLines: {
        display:false
        },
        ticks: {
        display: false
        }
        }]
        }
        }
        });


    }
}
});
</script>
<%- include('../partials/footer') %>

